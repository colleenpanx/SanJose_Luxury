<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–è·è¥¿å¥½ç‰©è³¼ğŸ‡ºğŸ‡¸ - ç¾åœ‹ç²¾å“ä»£è³¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fdf8f5;
        }

        .flower-bg {
            background-image: radial-gradient(#ffe4e6 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .product-card {
            transition: transform 0.2s;
            border-radius: 1.5rem;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            background: white;
            display: flex;
            flex-direction: column;
        }

        .img-slider {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .img-slider::-webkit-scrollbar { display: none; }

        .img-slider img {
            flex: 0 0 100%;
            scroll-snap-align: start;
            object-fit: cover;
            aspect-ratio: 1/1;
            background-color: #f3f4f6;
        }

        .brand-badge {
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            color: #d946ef;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* è·‘é¦¬ç‡ˆå‹•ç•« */
        @keyframes marquee {
            0% { transform: translateX(100vw); }
            100% { transform: translateX(-100%); }
        }
        .marquee-content {
            display: inline-block;
            white-space: nowrap;
            animation: marquee 25s linear infinite;
        }

        /* é¸ä¸­æŒ‰éˆ•æ¨£å¼å„ªåŒ– */
        .brand-btn-active {
            background-color: #ec4899 !important; /* pink-500 */
            color: #ffffff !important;
            font-weight: 700 !important;
            box-shadow: 0 4px 6px -1px rgba(236, 72, 153, 0.3) !important;
            border-color: #ec4899 !important;
        }
    </style>
</head>
<body class="flower-bg">

    <!-- è·‘é¦¬ç‡ˆå…¬å‘Šæ¬„ -->
    <div id="marquee-container" class="bg-pink-500 text-white py-2 overflow-hidden hidden shadow-sm">
        <div class="marquee-content text-sm font-bold" id="marquee-text">
            <!-- å…§å®¹å°‡å¾ CSV æŠ“å– -->
        </div>
    </div>

    <!-- é é¦– Header -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-pink-100">
        <div class="max-w-screen-md mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-2xl">ğŸ¦‹</span>
                <div class="flex flex-col">
                    <h1 class="text-xl font-bold text-gray-800 leading-none">è–è·è¥¿å¥½ç‰©è³¼ğŸ‡ºğŸ‡¸</h1>
                    <span class="text-[10px] text-pink-400 font-medium tracking-widest uppercase">San Jose Goodies</span>
                </div>
            </div>
            <a href="https://www.facebook.com/groups/183038802197503" target="_blank" class="bg-pink-500 text-white px-4 py-1.5 rounded-full text-sm font-bold flex items-center gap-1 shadow-md shadow-pink-200 active:scale-95 transition-transform">
                <i class="fab fa-facebook"></i> åŠ å…¥ç¤¾åœ˜
            </a>
        </div>
    </header>

    <!-- å“ç‰Œæ¨™ç±¤å¿«é€Ÿå°è¦½ - ä¿®æ”¹ç‚ºå¯æŠ˜è¡Œ (flex-wrap) -->
    <div class="max-w-screen-md mx-auto px-4 mt-6">
        <div id="brand-filter" class="flex flex-wrap gap-2 pb-2">
            <button onclick="filterByBrand('all')" id="btn-all" class="brand-btn brand-btn-active px-4 py-1.5 rounded-full border border-pink-100 text-xs shadow-sm transition-all">æ‰€æœ‰å•†å“</button>
        </div>
    </div>

    <!-- å•†å“åˆ—è¡¨å€å¡Š -->
    <main class="max-w-screen-md mx-auto px-4 py-4">
        <div id="product-container" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div id="loading-state" class="col-span-full text-center py-24 text-gray-400">
                <div class="animate-bounce mb-4 text-4xl">ğŸŒ¸</div>
                <p class="text-sm font-medium tracking-widest">æ­£åœ¨å¾ç¾åœ‹åŒæ­¥æœ€æ–°å¥½ç‰©...</p>
            </div>
        </div>
    </main>

    <!-- é å°¾ -->
    <footer class="text-center py-12 bg-white/50 mt-10 text-gray-400 text-xs leading-relaxed border-t border-pink-50">
        <div class="mb-4 text-pink-200 text-xl">âœ¨ âœ¨ âœ¨</div>
        <p class="font-bold text-gray-600 text-sm mb-1">è–è·è¥¿å¥½ç‰©è³¼ğŸ‡ºğŸ‡¸</p>
        <p class="mb-4">ç¾åœ‹ç²¾å“å¹³è¡Œè¼¸å…¥ãƒ»å“è³ªåš´é¸ãƒ»100% æ­£å“ä¿éšœ</p>
        
        <div class="bg-white mx-auto max-w-xs p-4 rounded-2xl shadow-sm border border-pink-50 text-gray-500 mb-6">
            <p class="font-bold mb-1"><i class="fas fa-store mr-1 text-pink-400"></i> é•·æ˜¥è·¯ç¸½åº—</p>
            <p>å°åŒ—å¸‚é•·æ˜¥è·¯380è™Ÿ1æ¨“</p>
            <p class="mt-1 opacity-70">æ­¡è¿é ç´„åº—å–æœå‹™</p>
        </div>
    </footer>

    <script>
        // CSV é€£çµ
        const PRODUCT_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQw6SB2ardXjIr4Sh0IhT8hnKkpUVeKDJiq-OI22riSHc8CX00K-f76fVUpyMjSNYynP06Pfhp40GJ9/pub?gid=0&single=true&output=csv';
        const MARQUEE_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQw6SB2ardXjIr4Sh0IhT8hnKkpUVeKDJiq-OI22riSHc8CX00K-f76fVUpyMjSNYynP06Pfhp40GJ9/pub?gid=664591331&single=true&output=csv';
        const FB_GROUP_URL = 'https://www.facebook.com/groups/183038802197503';
        const DIRECT_BUY_URL = 'https://www.facebook.com/groups/183038802197503/user/100015601080946/';

        let allProducts = [];

        // æ ¼å¼åŒ–åƒ¹æ ¼
        function formatPrice(val) {
            if (!val) return 'NT$ 0';
            const num = parseInt(val.toString().replace(/[^\d]/g, ''), 10);
            if (isNaN(num)) return val;
            return 'NT$ ' + num.toLocaleString();
        }

        // è§£æ CSV (é€šç”¨å‹ï¼Œè™•ç†é›™å¼•è™Ÿ)
        function parseGenericCSV(csvText) {
            const lines = [];
            let currentLine = [];
            let currentField = '';
            let inQuotes = false;

            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                const nextChar = csvText[i + 1];

                if (inQuotes) {
                    if (char === '"' && nextChar === '"') {
                        currentField += '"'; i++;
                    } else if (char === '"') {
                        inQuotes = false;
                    } else {
                        currentField += char;
                    }
                } else {
                    if (char === '"') {
                        inQuotes = true;
                    } else if (char === ',') {
                        currentLine.push(currentField);
                        currentField = '';
                    } else if (char === '\n' || char === '\r') {
                        if (char === '\r' && nextChar === '\n') i++;
                        currentLine.push(currentField);
                        lines.push(currentLine);
                        currentLine = [];
                        currentField = '';
                    } else {
                        currentField += char;
                    }
                }
            }
            if (currentLine.length > 0 || currentField !== '') {
                currentLine.push(currentField);
                lines.push(currentLine);
            }
            return lines;
        }

        // æŠ“å–ä¸¦æ›´æ–°è·‘é¦¬ç‡ˆ
        async function loadMarquee() {
            try {
                const response = await fetch(`${MARQUEE_CSV_URL}&t=${Date.now()}`);
                const csvText = await response.text();
                const rows = parseGenericCSV(csvText);
                
                const messages = rows
                    .map(r => r[0]?.trim())
                    .filter(msg => msg && msg !== '');

                if (messages.length > 0) {
                    const fullText = messages.join('ã€€âœ¨ã€€');
                    const container = document.getElementById('marquee-container');
                    const textEl = document.getElementById('marquee-text');
                    textEl.innerText = `ğŸŒ¸ ${fullText} ğŸŒ¸ ${fullText} ğŸŒ¸`;
                    container.classList.remove('hidden');
                }
            } catch (err) {
                console.error("è·‘é¦¬ç‡ˆè¼‰å…¥å¤±æ•—", err);
            }
        }

        async function init() {
            loadMarquee();

            try {
                const response = await fetch(`${PRODUCT_CSV_URL}&t=${Date.now()}`);
                const csvText = await response.text();
                const rows = parseGenericCSV(csvText);
                
                allProducts = [];
                for(let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row[0]) continue;
                    
                    const item = {
                        name: row[0]?.trim(),
                        marketPrice: formatPrice(row[1]),
                        salePrice: formatPrice(row[2]),
                        size: row[3]?.trim(),
                        brand: row[4]?.trim() || 'å…¶ä»–',
                        images: []
                    };
                    for (let j = 5; j < row.length; j++) {
                        const url = row[j]?.trim();
                        if (url && url.startsWith('http')) item.images.push(url);
                    }
                    allProducts.push(item);
                }

                updateBrandFilters(allProducts);
                renderProducts(allProducts);
            } catch (error) {
                console.error("è¼‰å…¥å¤±æ•—:", error);
            }
        }

        function updateBrandFilters(products) {
            const filterContainer = document.getElementById('brand-filter');
            // æŠ“å–æ‰€æœ‰å“ç‰Œä¸¦é€²è¡Œå­—æ¯æ’åº (A-Z)
            const brands = [...new Set(products.map(p => p.brand))].filter(b => b && b !== 'å…¶ä»–');
            brands.sort((a, b) => a.localeCompare(b, 'en', { sensitivity: 'base' }));

            brands.forEach(brand => {
                const btn = document.createElement('button');
                btn.className = 'brand-btn bg-white px-4 py-1.5 rounded-full border border-pink-50 text-xs text-gray-500 shadow-sm transition-all';
                btn.innerText = brand;
                btn.onclick = () => filterByBrand(brand, btn);
                filterContainer.appendChild(btn);
            });
        }

        function filterByBrand(brand, btnEl) {
            // æ¸…é™¤æ‰€æœ‰æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.brand-btn').forEach(b => {
                b.classList.remove('brand-btn-active');
                b.classList.add('bg-white', 'text-gray-500');
            });
            
            // è¨­å®šé»æ“ŠæŒ‰éˆ•çš„æ¨£å¼
            if (btnEl) {
                btnEl.classList.remove('bg-white', 'text-gray-500');
                btnEl.classList.add('brand-btn-active');
            } else {
                document.getElementById('btn-all').classList.add('brand-btn-active');
            }

            const filtered = brand === 'all' ? allProducts : allProducts.filter(p => p.brand === brand);
            renderProducts(filtered);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderProducts(products) {
            const container = document.getElementById('product-container');
            container.innerHTML = '';

            if (products.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-20 text-gray-400 text-sm">ç›®å‰æ²’æœ‰ç›¸é—œå•†å“ä¸Šæ¶å–”ï¼</div>`;
                return;
            }

            products.forEach(p => {
                const card = document.createElement('div');
                card.className = 'product-card';
                
                const imagesHTML = p.images.length > 0 
                    ? p.images.map(img => `<img src="${img}" alt="${p.name}" onclick="window.location.href='${DIRECT_BUY_URL}'" onerror="this.src='https://via.placeholder.com/400?text=åœ–ç‰‡è¼‰å…¥ä¸­'">`).join('')
                    : `<img src="https://via.placeholder.com/400x400?text=è–è·è¥¿å¥½ç‰©è³¼" alt="No Image">`;

                card.innerHTML = `
                    <div class="relative">
                        <div class="img-slider">${imagesHTML}</div>
                        <div class="absolute top-3 left-3">
                            <span class="brand-badge">${p.brand}</span>
                        </div>
                        ${p.images.length > 1 ? `
                        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/30 backdrop-blur-md text-white text-[10px] px-3 py-1 rounded-full flex items-center gap-1">
                            <i class="fas fa-arrows-left-right"></i> å·¦å³æ»‘å‹•
                        </div>` : ''}
                    </div>
                    <div class="p-5 flex-grow flex flex-col justify-between">
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg mb-1 leading-tight">${p.name}</h3>
                            <div class="flex items-center gap-2 mb-3">
                                <span class="bg-gray-100 text-gray-500 text-[10px] px-2 py-0.5 rounded tracking-wider">SIZE: ${p.size || 'F'}</span>
                            </div>
                        </div>
                        <div class="mt-auto">
                            <div class="flex flex-col mb-3">
                                <span class="text-gray-400 text-xs line-through">å°ˆæ«ƒåƒ¹ ${p.marketPrice}</span>
                                <span class="text-pink-600 font-extrabold text-2xl">${p.salePrice}</span>
                            </div>
                            <button onclick="window.location.href='${DIRECT_BUY_URL}'" 
                                    class="w-full bg-pink-500 text-white py-2.5 rounded-full text-sm font-bold shadow-md shadow-pink-100 hover:bg-pink-600 active:scale-95 transition-all">
                                ç«‹å³ç§è¨Šè³¼è²·
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        init();
    </script>
</body>
</html>
